<div class="transferencia-container">
  <div class="card main-card">
    <div class="card-header">
      <h1 class="card-title">Sistema de Agendamento de Transfer√™ncias Financeiras</h1>
    </div>
    <div class="card-body">
      
      
      <div class="tab-navigation">
        <button class="tab-btn" [class.active]="activeTab === 'agendamento'" (click)="setActiveTab('agendamento')">
          <i class="tab-icon">üìÖ</i>
          Agendar Transfer√™ncia
        </button>
        <button class="tab-btn" [class.active]="activeTab === 'extrato'" (click)="setActiveTab('extrato')">
          <i class="tab-icon">üìã</i>
          Extrato de Agendamentos
        </button>
        <button class="tab-btn" [class.active]="activeTab === 'taxas'" (click)="setActiveTab('taxas')">
          <i class="tab-icon">‚ÑπÔ∏è</i>
          Tabela de Taxas
        </button>
      </div>

      <div *ngIf="activeTab === 'agendamento'" class="tab-content">
        <div class="form-container">
          
          <div class="alert alert-warning">
            <span>
              <i class="taxa-icon warning">‚ö†</i>
              Preencha por ultimo o valor da transfer√™ncia para calcular a taxa de transfer√™ncia.
            </span>              
          </div>
                    
          <div *ngIf="vm.error$ | async as error" class="alert alert-error">
            <strong>Erro:</strong> {{ error }}
            <button class="alert-close" (click)="vm.clearError()">√ó</button>
          </div>
          
          <div class="form-grid">
            
            <div class="form-field">
              <label for="contaOrigem" class="label">Conta de Origem</label>
              <input 
                type="text"
                class="input"
                id="contaOrigem"
                [value]="formData.contaOrigem"
                (input)="onContaOrigemChange($event)"
                placeholder="XXXXXXXXXX"
                maxlength="10"
                [class.error]="errorContaOrigem(formData.contaOrigem || '', formData.contaDestino || '')">
              <small *ngIf="errorContaOrigem(formData.contaOrigem || '', formData.contaDestino || '')" class="error-message">
                {{ mensagemErroContaOrigem }}
              </small>
            </div>

            
            <div class="form-field">
              <label for="contaDestino" class="label">Conta de Destino</label>
              <input 
                type="text"
                class="input"
                id="contaDestino"
                [value]="formData.contaDestino"
                (input)="onContaDestinoChange($event)"
                placeholder="XXXXXXXXXX"
                maxlength="10"
                [class.error]="errorContaDestino(formData.contaDestino || '', formData.contaOrigem || '')">
              <small *ngIf="errorContaDestino(formData.contaDestino || '', formData.contaOrigem || '')" class="error-message">
                {{ mensagemErroContaDestino }}
              </small>
            </div>

            
            <div class="form-field">
              <label for="valor" class="label">Valor da Transfer√™ncia</label>
              <input 
                type="number"
                class="input"
                id="valor"
                [value]="formData.valor"
                (input)="onValorChange($event)"
                step="0.01"
                min="0.01"
                max="999999.99"
                placeholder="0,00">
            </div>

            
            <div class="form-field">
              <label for="dataTransferencia" class="label">Data da Transfer√™ncia</label>
              <input 
                type="date"
                class="input"
                id="dataTransferencia"
                [value]="formatDateForInput(formData.dataTransferencia)"
                (change)="onDataTransferenciaChange($event)"
                [min]="formatDateForInput(today)">
            </div>

            
            <div class="form-field taxa-info">
              <label class="label">Taxa Aplic√°vel</label>
              <div class="taxa-display" [class.no-taxa]="!(vm.taxaCalculada$ | async)">
                <span *ngIf="vm.taxaCalculada$ | async as taxa; else noTaxa">
                  <i class="taxa-icon success">‚úì</i>
                  {{ formatCurrency(taxa) }}
                </span>
                <ng-template #noTaxa>
                  <span class="no-taxa-message">
                    <i class="taxa-icon warning">‚ö†</i>
                    Nenhuma taxa aplic√°vel para este valor
                  </span>
                </ng-template>
              </div>
              
              
              <div *ngIf="vm.taxaInfo$ | async as taxaInfo" class="taxa-details">
                <small>{{ taxaInfo.diaDe }} a {{ taxaInfo.diaAte }} dias - {{ taxaInfo.valorTaxaTransferencia | number:'1.2-2' }} + {{ taxaInfo.valorAdicional | number:'1.2-2' }}</small>
              </div>
            </div>

            
            <div class="form-field">
              <label class="label">Data de Agendamento</label>
              <input 
                type="text"
                class="input"
                [value]="formatDate(formData.dataAgendamento || today)"
                readonly
                disabled>
              <small>Data atual (autom√°tica)</small>
            </div>

          </div>

          
          <div class="form-actions">
            <button  *ngIf="vm.canSubmit()"
              class="btn btn-success"
              (click)="onSubmit()">
              <span *ngIf="vm.loading$ | async">‚è≥</span>
              <span *ngIf="!(vm.loading$ | async)">‚úì</span>
              Agendar Transfer√™ncia
            </button>
            
            <button 
              class="btn btn-secondary"
              (click)="onReset()">
              üîÑ Limpar Formul√°rio
            </button>
          </div>

        </div>
      </div>

      
      <div *ngIf="activeTab === 'extrato'" class="tab-content">
        <div class="extrato-container">
          
          
          <div *ngIf="vm.loading$ | async" class="loading-container">
            <div class="spinner"></div>
            <p>Carregando agendamentos...</p>
          </div>

          
          <div *ngIf="!(vm.loading$ | async)">
            <div class="table-container">
              <table class="table">
                <thead>
                  <tr>
                    <th>C√≥digo</th>
                    <th>Conta Origem</th>
                    <th>Conta Destino</th>
                    <th>Valor Total</th>
                    <th>Data Transfer√™ncia</th>
                    <th>Data Agendamento</th>
                    <th>Status</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let agendamento of vm.agendamentos$ | async">
                    <td>{{ agendamento.codigoAgendamento }}</td>
                    <td>{{ agendamento.contaOrigem }}</td>
                    <td>{{ agendamento.contaDestino }}</td>
                    <td>{{ formatCurrency(agendamento.valor) }}</td>
                    <td>{{ formatDate(agendamento.dataTransferencia) }}</td>
                    <td>{{ formatDate(agendamento.dataAgendamento) }}</td>
                    <td>
                      <span class="badge" [class]="getStatusClass(agendamento.statusAgendamento)">
                        {{ agendamento.statusAgendamento }}
                      </span>
                    </td>
                  </tr>
                  <tr *ngIf="!(vm.agendamentos$ | async)?.length">
                    <td colspan="8" class="text-center">
                      <p>Nenhum agendamento encontrado</p>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

        </div>
      </div>

      
      <div *ngIf="activeTab === 'taxas'" class="tab-content">
        <div class="taxas-container">
          <div class="card info-card">
            <div class="card-header">
              <h2 class="card-title">Tabela de Taxas por Dias de Transfer√™ncia</h2>
            </div>
            <div class="card-body">
              <div class="table-container">
                <table class="table">
                  <thead>
                    <tr>
                      <th colspan="2">Dias Transfer√™ncia</th>
                      <th rowspan="2">R$</th>
                      <th rowspan="2">Taxa</th>
                    </tr>
                    <tr>
                      <th>De</th>
                      <th>At√©</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let taxa of vm.taxasDisponiveis$ | async">
                      <td>{{ taxa.diaDe }}</td>
                      <td>{{ taxa.diaAte }}</td>
                      <td>{{ taxa.taxa > 0 ? 'R$ ' + (taxa.taxa | number:'1.2-2') : 'R$ 0,00' }}</td>
                      <td>{{ taxa.porcentagem }}%</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

